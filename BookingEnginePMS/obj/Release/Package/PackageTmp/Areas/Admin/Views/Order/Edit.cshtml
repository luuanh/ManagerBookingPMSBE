@using BookingEnginePMS.Models;
@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    List<string> countries = (List<string>)ViewData["countries"];
    List<TransitionLanguage> transitions = (List<TransitionLanguage>)Session["transitions"];
    Transition transition = new Transition(transitions);
}
<script src="~/Areas/Admin/Content/js/Order/order-edit.js"></script>
<script>
    $("#menu_4").addClass('click-menu-top')
</script>
<div class="uk-grid">
    <div class="uk-width-1-1 uk-margin-bottom">
        <h3>@(transition.Translate(320, "Detail Order")) | <span ng-cloak style="font-weight: bold;color: #de0b0b;">{{GuestOrderCode}}</span></h3>
    </div>
    <div class="uk-width-1-1 uk-margin-small-bottom" ng-cloak>
        <div class="uk-grid" style="margin-left: -20px;">
            <div class="uk-width-1 uk-margin-medium-bottom" style="padding-left: 20px;">
                <hr style="margin:0" />
            </div>
            <div class="uk-width-large-1-4 uk-width-medium-1 uk-margin-bottom" style="padding-left: 20px;">
                <div class="uk-grid" style="margin-top:-27px">
                    <div class="uk-width-1">
                        <ul class="uk-tab" data-uk-tab="{connect:'#tabs_order',swiping: false}">
                            <li class="genenral-tab uk-active"><a href="#">@(transition.Translate(303, "Order"))</a></li>
                            <li><a href="#">@(transition.Translate(304, "Guest"))</a></li>
                        </ul>
                        <ul id="tabs_order" class="uk-switcher uk-margin" style="overflow: unset;padding-top: 10px;">
                            <li class="genenral-tab">
                                @Html.Partial("~/Areas/Admin/Views/Order/pOrder.cshtml", transition)
                            </li>
                            <li>
                                @Html.Partial("~/Areas/Admin/Views/Order/pGuest.cshtml", countries, new ViewDataDictionary { { "transition", transition }, { "guests", ViewData["guests"] } })
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="uk-width-large-3-4 uk-width-medium-1" style="padding-left: 20px;">
                <div class="uk-grid" style="margin-top: -20px;">
                    <div class="uk-width-medium-1">
                        @Html.Partial("~/Areas/Admin/Views/Reservation/New/pService.cshtml", transition)
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="uk-width-1 box-edit-booking uk-margin-top uk-text-right" ng-cloak>
        <button ng-if="!status" class="md-btn md-btn-danger md-btn-wave-light" ng-click="confirmCloseOrder()">@(transition.Translate(321, "Close Order"))</button>
        <button ng-if="!status" class="md-btn md-btn-new md-btn-wave-light" ng-click="Put()">@(transition.Translate(322, "Update"))</button>
        <div ng-if="!status" class="uk-button-dropdown uk-text-left" data-uk-dropdown="{pos:'top-left',mode:'click'}" style="z-index: 9999;float:left">
            <button class="md-btn md-btn-new md-btn-wave-light">@(transition.Translate(323, "Option")) <i class="material-icons">&#xE313;</i></button>
            <div class="uk-dropdown">
                <ul class="uk-nav uk-nav-dropdown">
                    <li><a ng-click="showAssignToReservation()">@(transition.Translate(324, "Move to Reservation"))</a></li>
                </ul>
            </div>
        </div>
        <a target="_blank" href="/Admin/Print/Order?id={{guestOrderChoose}}" class="md-btn md-btn-new md-btn-wave-light" style="float:left;margin-left: 10px;">@(transition.Translate(325, "Print Bill"))</a>
    </div>
</div>

<div id="ModalCloseOrder" class="uk-modal">
    <div class="uk-modal-dialog">
        <button type="button" class="uk-modal-close uk-close"></button>
        <h2 class="heading_a">@(transition.Translate(321, "Close Order"))</h2>
        <div>
            <div class="uk-grid uk-margin-bottom">
                <div class="uk-width-1">
                    <div style="padding: 0 10px;">
                        <div class="uk-grid uk-margin-small-bottom">
                            <div class="uk-width-medium-1-2 uk-width-1-3">
                                <b>@(transition.Translate(326, "Total Amount")):</b>
                            </div>
                            <div class="uk-width-medium-1-2 uk-width-2-3 uk-text-right">
                                <span style="font-weight: 700;font-size: 16px;">{{ServicePrice | currency:'':'0'}} ₫</span>
                            </div>
                        </div>
                        <div class="uk-grid uk-margin-small-bottom">
                            <div class="uk-width-medium-1-2 uk-width-1-3">
                                <b>@(transition.Translate(327, "Pay")):</b>
                            </div>
                            <div class="uk-width-medium-1-2 uk-width-2-3 uk-text-right">
                                <input ng-click="RefreshValidate()" ng-model="payCloseOrder" type="text" class="md-input uk-text-right" />
                                <span id="err_payCloseOrder" class="error">@(transition.Translate(314, "Value is invalid"))!</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="uk-grid">
                <div class="uk-width-1 uk-text-right">
                    <button class="md-btn md-btn-new md-btn-wave-light" ng-click="CloseOrder()">@(transition.Translate(328, "OK"))</button>
                    <button class="md-btn uk-modal-close uk-close md-btn-wave-light">@(transition.Translate(329, "Cancel"))</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="ModalAssignReservation" class="uk-modal">
    <div class="uk-modal-dialog uk-modal-dialog-large">
        <button type="button" class="uk-modal-close uk-close"></button>
        <h2 class="heading_a">@(transition.Translate(330, "Assign Order To Reservation"))</h2>
        <div>
            <div class="uk-grid uk-margin-bottom">
                <div class="uk-width-medium-1-3 uk-margin-bottom">
                    <div class="uk-input-group">
                        <div class="md-input-wrapper">
                            <label><b>@(transition.Translate(331, "Key Search"))</b></label>
                            <input ng-model="findReservationId" type="text" class="md-input" placeholder="@(transition.Translate(334, "Reservation Code"))">
                            <span class="md-input-bar "></span>
                        </div>
                        <span class="uk-input-group-addon" ng-click="FindReservation()">
                            <a class="md-btn md-btn-new">@(transition.Translate(332, "Search"))</a>
                        </span>
                    </div>
                </div>
                <div class="uk-width-1 uk-margin-bottom">
                    <h5 class="title-box-small-accomodation" style="margin-bottom:0">
                        <b>@(transition.Translate(333, "Reservation Information"))</b>
                    </h5>
                    <div class="uk-overflow-container box-schedule-price" style="margin: 0px !important;">
                        <table class="uk-table uk-table-bordered">
                            <thead>
                                <tr>
                                    <th>@(transition.Translate(334, "Reservation Code"))</th>
                                    <th>@(transition.Translate(309, "Name"))</th>
                                    <th>@(transition.Translate(315, "SurName"))</th>
                                    <th>@(transition.Translate(335, "Date Booked"))</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <span>{{ClustersReservation.reservation.ReservationId}}</span>
                                    </td>
                                    <td>
                                        <span>{{ClustersReservation.reservation.FirstName}}</span>
                                    </td>
                                    <td>
                                        <span>{{ClustersReservation.reservation.SurName}}</span>
                                    </td>
                                    <td>
                                        <span>{{ClustersReservation.reservation.CreateDate | date:'dd/MM/yyyy HH:mm'}}</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="uk-width-1">
                    <h5 class="title-box-small-accomodation" style="margin-bottom:0">
                        <b>@(transition.Translate(333, "Reservation Information"))</b>
                    </h5>
                    <div class="uk-overflow-container box-schedule-price" style="margin: 0px !important;">
                        <table class="uk-table uk-table-bordered">
                            <thead>
                                <tr>
                                    <th>@(transition.Translate(336, "Folio"))</th>
                                    <th>@(transition.Translate(337, "Accommodation"))</th>
                                    <th>@(transition.Translate(338, "Room"))</th>
                                    <th>@(transition.Translate(339, "Type"))</th>
                                    <th>@(transition.Translate(340, "Check in"))</th>
                                    <th>@(transition.Translate(341, "Check out"))</th>
                                    <th>@(transition.Translate(344, "Balance"))</th>
                                    <th>@(transition.Translate(342, "Status"))</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in ClustersReservation.bookings track by $index">
                                    <td>
                                        <span>{{item.BookingId}}</span>
                                    </td>
                                    <td>
                                        <span>{{item.RoomTypeName}}</span>
                                    </td>
                                    <td>
                                        <span ng-if="item.RoomId > 0">{{item.RoomCode}}</span>
                                        <span ng-if="item.RoomId < 0">N/A</span>
                                    </td>
                                    <td>
                                        <span>{{getTypeReservation(item.TypeBooking)}}</span>
                                    </td>
                                    <td>
                                        <span>{{item.ArrivalDate | date:'dd/MM/yyyy HH:mm'}}</span>
                                    </td>
                                    <td>
                                        <span>{{item.DepartureDate | date:'dd/MM/yyyy HH:mm'}}</span>
                                    </td>
                                    <td>
                                        <span>{{(item.Total - item.Paid - item.PrePaid) | currency:'':'0'}} ₫</span>
                                    </td>
                                    <td>
                                        <span ng-bind-html="getStatus(item.Status)"></span>
                                    </td>
                                    <td class="uk-text-center">
                                        <button ng-click="AssignOrderToBooking(item.BookingId)" class="md-btn md-btn-new md-btn-wave-light">@(transition.Translate(343, "Assign"))</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="uk-grid">
                <div class="uk-width-1 uk-text-right">
                    <button class="md-btn uk-modal-close uk-close md-btn-wave-light">@(transition.Translate(329, "Cancel"))</button>
                </div>
            </div>
        </div>
    </div>
</div>