@using BookingEnginePMS.Models;
@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    List<TransitionLanguage> transitions = (List<TransitionLanguage>)Session["transitions"];
    Transition transition = new Transition(transitions);
}
<style>
    .box-status-reservation > label {
        margin-right: 12px;
    }

    .box-reservation th, .box-reservation td {
        vertical-align: middle !important;
        border-right: 1px solid #D4D4D4;
    }

        .box-reservation th:last-of-type, .box-reservation td:last-of-type {
            border-right: none
        }

    .box-reservation tbody tr {
        height: 40px;
    }

    .box-reservation th:first-of-type, .box-reservation tr:first-of-type {
        border-left: none !important
    }

    .box-reservation th:last-of-type, .box-reservation tr:last-of-type {
        border-right: none !important
    }

    .box-reservation tbody tr:nth-child(even) {
        background: #F3F3F3;
    }

    .box-reservation tbody tr:nth-child(odd) {
        background: #FDFDFD;
    }

    .box-change-page > a {
        display: inline-block;
        width: 30px;
        border: 1px solid #cbcbcb;
        padding: 3px;
        text-align: center;
        border-radius: 5px;
        background: #F3F3F3;
    }

    .box-change-page input {
        width: 40px;
        padding: 5px;
        border-radius: 2px;
        border: 1px solid #d7d7d7;
    }

    .box-change-page select {
        margin-left: 20px;
        min-width: 60px;
        border-radius: 3px;
        padding: 5px !IMPORTANT;
    }
</style>
<script>
    $("#menu_3").addClass('click-menu-top')
</script>
<script src="~/Areas/Admin/Content/js/TransferDebt/transfer-debt-reservation.js"></script>
<div class="uk-grid">
    <div class="uk-width-1-1 uk-margin-medium-bottom">
        <h3 style="display: inline-block;margin-right: 10px;">@(transition.Translate(240, "Transfer of Debt"))/ <span style="font-size: 15px;">@(transition.Translate(241, "Show by reservation"))</span></h3>
        <hr />
        <p>
            @(transition.Translate(242, "tip"))
        </p>
        <hr />
    </div>
    <div class="uk-width-1-1 uk-margin-small-bottom" ng-cloak>
        <div class="uk-grid">
            <div class="uk-width-large-1-6 uk-width-medium-1-4 uk-margin-bottom">
                <div class="uk-input-group">
                    <div class="md-input-wrapper">
                        <label><b>@(transition.Translate(243, "From date"))</b></label>
                        <input id="FromDate" data-uk-datepicker="{format:'DD-MM-YYYY'}" autocomplete="off" ng-model="FromDate" type="text" class="md-input">
                        <span class="md-input-bar "></span>
                    </div>
                    <span class="uk-input-group-addon"><i class="uk-input-group-icon uk-icon-calendar"></i></span>
                </div>
            </div>
            <div class="uk-width-large-1-6 uk-width-medium-1-4 uk-margin-bottom">
                <div class="uk-input-group">
                    <div class="md-input-wrapper">
                        <label><b>@(transition.Translate(244, "To date"))</b></label>
                        <input id="ToDate" data-uk-datepicker="{format:'DD-MM-YYYY'}" autocomplete="off" ng-model="ToDate" type="text" class="md-input">
                        <span class="md-input-bar "></span>
                    </div>
                    <span class="uk-input-group-addon"><i class="uk-input-group-icon uk-icon-calendar"></i></span>
                </div>
            </div>
            <div class="uk-width-large-1-6 uk-width-medium-1-4 uk-width-1-2 uk-margin-bottom">
                <div class="md-input-wrapper">
                    <label><b></b></label>
                    <button class="md-btn-new md-btn md-btn-wave-light" ng-click="GetData()">@(transition.Translate(245, "Search"))</button>
                </div>
            </div>
            <div class="uk-width-large-3-6 uk-width-medium-1-4 uk-width-1-2 uk-text-right uk-margin-bottom">
                <div class="md-input-wrapper" ng-if="hasItemChoose">
                    <label><b></b></label>
                    <button class="md-btn-new md-btn md-btn-wave-light" ng-click="confirmPayAllReservationChoose()">@(transition.Translate(246, "Pay all item choose"))</button>
                </div>
            </div>
        </div>
    </div>
    <div class="uk-width-1-1 uk-margin-bottom">
        <div style="border: 1px solid #D4D4D4;border-top: none;" ng-cloak>
            <div class="uk-grid">
                <div class="uk-width-1">
                    <div class="uk-overflow-container">
                        <div class=" box-reservation">
                            <table class="uk-table uk-table-bordered" style="border-collapse: collapse;">
                                <thead>
                                    <tr style="background: linear-gradient(rgb(246, 247, 248), rgb(215, 215, 215));">
                                        <th class="uk-text-center">@(transition.Translate(247, "ResCode"))</th>
                                        <th class="uk-text-center">@(transition.Translate(248, "Name"))</th>
                                        <th class="uk-text-center">@(transition.Translate(249, "SurName"))</th>
                                        <th class="uk-text-center">@(transition.Translate(250, "Folios"))</th>
                                        <th class="uk-text-center">@(transition.Translate(251, "Check in"))</th>
                                        <th class="uk-text-center">@(transition.Translate(252, "Check out"))</th>
                                        <th class="uk-text-center">@(transition.Translate(253, "Day of debit"))</th>
                                        <th class="uk-text-center">@(transition.Translate(254, "Total Amount")) (₫)</th>
                                        <th class="uk-text-center" style="min-width: 70px;">@(transition.Translate(255, "Paid")) (₫)</th>
                                        <th class="uk-text-center" style="min-width: 70px;">@(transition.Translate(256, "Owe")) (₫)</th>
                                        <th class="uk-text-center">@(transition.Translate(257, "Action"))</th>
                                        <th class="uk-text-center">
                                            <input ng-change="changeCheckAll()" attrCal="{{checkHasItemChoose()}}" type="checkbox" ng-model="checkAllReservationPayDebt" />
                                        </th>
                                    </tr>
                                </thead>
                                <tbody ng-cloak>
                                    <tr ng-repeat="item in data">
                                        <td class="uk-text-center numeric">
                                            <a target="_blank" href="/Admin/Reservation/Edit?id={{item.ReservationId}}">{{item.ReservationId}}</a>
                                        </td>
                                        <td>
                                            <a target="_blank" href="/Admin/Reservation/Edit?id={{item.ReservationId}}">{{item.FirstName}}</a>
                                        </td>
                                        <td>
                                            <a target="_blank" href="/Admin/Reservation/Edit?id={{item.ReservationId}}">{{item.SurName}}</a>
                                        </td>
                                        <td>{{item.Folios}}</td>
                                        <td class="uk-text-center">{{item.CheckIn | date:"dd-MM-yyyy HH:mm"}}</td>
                                        <td class="uk-text-center">{{item.CheckOut | date:"dd-MM-yyyy HH:mm"}}</td>
                                        <td class="uk-text-center">{{item.TransferDebtDate | date:"dd-MM-yyyy HH:mm:ss"}}</td>
                                        <td class="uk-text-right">{{item.TotalAmount | currency:'':'0'}}</td>
                                        <td class="uk-text-right">{{item.Paid | currency:'':'0'}}</td>
                                        <td class="uk-text-right">{{(item.TotalAmount - item.Paid) | currency:'':'0'}}</td>
                                        <td class="uk-text-center">
                                            <button ng-click="payReservation(item.ReservationId)" class="md-btn md-btn-mini md-btn-new md-btn-wave-light">@(transition.Translate(258, "Pay"))</button>
                                        </td>
                                        <td class="uk-text-center">
                                            <input type="checkbox" ng-model="item.Choose" />
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr style="background: linear-gradient(rgb(246, 247, 248), rgb(215, 215, 215));">
                                        <th colspan="6"></th>
                                        <th class="uk-text-right">@(transition.Translate(259, "Total price"))</th>
                                        <th class="uk-text-right">{{totalPrice | currency:'':'0'}}</th>
                                        <th class="uk-text-right">{{totalPaid | currency:'':'0'}}</th>
                                        <th class="uk-text-right">{{(totalPrice - totalPaid) | currency:'':'0'}}</th>
                                        <th colspan="2"></th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="uk-grid">
                <div class="uk-width-1" ng-cloak>
                    <div class="box-change-page" style="margin:10px">
                        <a ng-click="fixPage(1)"><i class="uk-icon-step-backward"></i></a>
                        <a ng-click="changePage(-1)"><i class="uk-icon-backward"></i></a>
                        <input ng-model="filters.pageNumber" class="box-numberpage" type="number" min="1" max="{{maxPage}}" />
                        <span> / {{maxPage}}</span>
                        <a ng-click="changePage(1)"><i class="uk-icon-forward"></i></a>
                        <a ng-click="fixPage(maxPage)"><i class="uk-icon-step-forward"></i></a>

                        <select ng-change="ChangePageSize()" ng-model="filters.pageSize" style="min-width: 60px;" convert-to-number>
                            <option value="2">2</option>
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="200">200</option>
                        </select>
                        <span>@(transition.Translate(260, "items per page"))</span>
                        <span style="float:right">
                            {{currentPage()}} -
                            {{numberItemInPage()}}
                            @(transition.Translate(261, "of")) {{totalRecord}} @(transition.Translate(262, "items"))
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="ModalPayDeb" class="uk-modal">
    <div class="uk-modal-dialog uk-modal-dialog-large">
        <button type="button" class="uk-modal-close uk-close"></button>
        <h2 class="heading_a">@(transition.Translate(263, "Pay Debt Transfer"))</h2>
        <div>
            <div class="uk-grid uk-margin-bottom">
                <div class="uk-width-1 uk-margin-bottom">
                    <div class="uk-grid">
                        <div class="uk-width-1-3">
                            <div class="md-input-wrapper">
                                <label><b>@(transition.Translate(264, "Reservation Code"))</b></label>
                                <span style="padding-left: 5px;font-size: 16px;font-weight: 600;">{{reservationChoose.ReservationId}}</span>
                            </div>
                        </div>
                        <div class="uk-width-2-3">
                            <div class="md-input-wrapper">
                                <label><b>@(transition.Translate(265, "Guest's Name"))</b></label>
                                <span style="padding-left: 5px;font-size: 16px;font-weight: 600;">{{reservationChoose.FirstName}} {{reservationChoose.SurName}}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="uk-width-1 uk-margin-bottom">
                    <div class="md-input-wrapper" style="padding-top: 0;">
                        <h4 class="title-box-accomodation"><b>@(transition.Translate(266, "Booking")) </b></h4>
                        <table class="uk-table uk-table-bordered" style="border: 1px solid #f0f0f0;border-top:none;border-collapse:collapse">
                            <thead>
                                <tr style="background: linear-gradient(rgb(246, 247, 248), rgb(215, 215, 215));">
                                    <th class="uk-text-center">@(transition.Translate(267, "Folio"))</th>
                                    <th class="uk-text-center">@(transition.Translate(268, "Accom"))</th>
                                    <th class="uk-text-center">@(transition.Translate(251, "Check in"))</th>
                                    <th class="uk-text-center">@(transition.Translate(252, "Check out"))</th>
                                    <th class="uk-text-center">@(transition.Translate(269, "Total")) (₫)</th>
                                    <th class="uk-text-center">@(transition.Translate(255, "Paid")) (₫)</th>
                                    <th class="uk-text-center">@(transition.Translate(256, "Owe")) (₫)</th>
                                    <th class="uk-text-center">@(transition.Translate(258, "Pay")) (₫)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in debtBookings">
                                    <td class="uk-text-center">{{item.BookingId}}</td>
                                    <td>{{item.RoomTypeName}}</td>
                                    <td class="uk-text-center">{{item.ArrivalDate | date:'dd/MM/yyyy HH:mm'}}</td>
                                    <td class="uk-text-center">{{item.DepartureDate | date:'dd/MM/yyyy HH:mm'}}</td>
                                    <td class="uk-text-right"><b>{{item.Total | currency:'':'0'}}</b></td>
                                    <td class="uk-text-right"><b>{{::item.Paid | currency:'':'0'}}</b></td>
                                    <td class="uk-text-right">
                                        <span style="font-weight: bold;color: #c11212;">
                                            {{::(item.Total - item.Paid) | currency:'':'0'}}
                                        </span>
                                    </td>
                                    <td class="uk-text-center">
                                        <input ng-click="refreshErroInp()" id="inp_{{$index}}" type="text" ng-model="item.PayDebt" class="md-input inpPaydebt" style="width: 100px;display: initial;text-align:right" />
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="uk-grid">
                <div class="uk-width-1 uk-text-right">
                    <button class="md-btn md-btn-new" ng-click="PayDebtBooking()">@(transition.Translate(270, "Confirm"))</button>
                    <button class="md-btn uk-modal-close uk-close">@(transition.Translate(271, "Cancel"))</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="ModalPayAllReservationChoose" class="uk-modal">
    <div class="uk-modal-dialog uk-modal-dialog-large">
        <button type="button" class="uk-modal-close uk-close"></button>
        <h2 class="heading_a">@(transition.Translate(272, "All Reservation Chosen"))</h2>
        <div>
            <div class="uk-grid uk-margin-bottom">
                <div class="uk-width-1 uk-margin-bottom">
                    <div class="md-input-wrapper" style="padding-top: 0;">
                        <h4 class="title-box-accomodation"><b>@(transition.Translate(273, "Reservation")) </b></h4>
                        <table class="uk-table uk-table-bordered" style="border: 1px solid #f0f0f0;border-top:none;border-collapse:collapse">
                            <thead>
                                <tr style="background: linear-gradient(rgb(246, 247, 248), rgb(215, 215, 215));">
                                    <th class="uk-text-center">@(transition.Translate(247, "ResCode"))</th>
                                    <th class="uk-text-center">@(transition.Translate(248, "Name"))</th>
                                    <th class="uk-text-center">@(transition.Translate(249, "SurName"))</th>
                                    <th class="uk-text-center">@(transition.Translate(251, "Check in"))</th>
                                    <th class="uk-text-center">@(transition.Translate(252, "Check out"))</th>
                                    <th class="uk-text-center">@(transition.Translate(254, "Total Amount")) (₫)</th>
                                    <th class="uk-text-center" style="min-width: 70px;">@(transition.Translate(255, "Paid")) (₫)</th>
                                    <th class="uk-text-center" style="min-width: 70px;">@(transition.Translate(256, "Owe")) (₫)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in reservationChooseToPayDebt">
                                    <td class="uk-text-center">{{item.ReservationId}}</td>
                                    <td>{{item.FirstName}}</td>
                                    <td>{{item.SurName}}</td>
                                    <td class="uk-text-center">{{item.CheckIn | date:"dd-MM-yyyy HH:mm"}}</td>
                                    <td class="uk-text-center">{{item.CheckOut | date:"dd-MM-yyyy HH:mm"}}</td>
                                    <td class="uk-text-right">{{item.TotalAmount | currency:'':'0'}}</td>
                                    <td class="uk-text-right">{{item.Paid | currency:'':'0'}}</td>
                                    <td class="uk-text-right">{{(item.TotalAmount - item.Paid) | currency:'':'0'}}</td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr style="background: linear-gradient(rgb(246, 247, 248), rgb(215, 215, 215));">
                                    <th colspan="4" attCal="{{calTotalPriceOfReservationChooseToPay()}}"></th>
                                    <th class="uk-text-right">@(transition.Translate(259, "Total price"))</th>
                                    <th class="uk-text-right">{{totalPriceChosen | currency:'':'0'}}</th>
                                    <th class="uk-text-right">{{totalPaidChosen | currency:'':'0'}}</th>
                                    <th class="uk-text-right">{{(totalPriceChosen - totalPaidChosen) | currency:'':'0'}}</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
            <div class="uk-grid">
                <div class="uk-width-1 uk-text-right">
                    <button class="md-btn md-btn-new" ng-click="PayAllReservationChoose()">@(transition.Translate(274, "Pay All"))</button>
                    <button class="md-btn uk-modal-close uk-close">@(transition.Translate(271, "Cancel"))</button>
                </div>
            </div>
        </div>
    </div>
</div>